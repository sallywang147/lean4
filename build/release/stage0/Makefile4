WASMC = /usr/local/share/wasm-toolchain/sysroot/bin/clang
WASMC_OPTS = -Os
WASMC_INCLUDE = -I/home/sally/lean4/build/release/stage0/include
WASM_OUT = /home/sally/lean4/WasmLib

SRC_ROOT = /home/sally/lean4/stage0/stdlib

0_SOURCES_ALL := $(wildcard /home/sally/lean4/stage0/stdlib/*.c)
0_SOURCES := $(filter-out $(SRC_ROOT)/LakeMain.c, $(0_SOURCES_ALL))
1_SOURCES := $(wildcard /home/sally/lean4/stage0/stdlib/*/*.c)
2_SOURCES := $(wildcard /home/sally/lean4/stage0/stdlib/*/*/*.c)
3_SOURCES := $(wildcard /home/sally/lean4/stage0/stdlib/*/*/*/*.c)
4_SOURCES := $(wildcard /home/sally/lean4/stage0/stdlib/*/*/*/*/*.c)
5_SOURCES := $(wildcard /home/sally/lean4/stage0/stdlib/*/*/*/*/*/*.c)
6_SOURCES := $(wildcard /home/sally/lean4/stage0/stdlib/*/*/*/*/*/*/*.c)

ALL_SOURCES :=$(0_SOURCES) $(1_SOURCES) $(2_SOURCES) $(3_SOURCES) $(4_SOURCES) $(5_SOURCES) $(6_SOURCES)

# Generate wasm file names by replacing SRC_ROOT with WASM_OUT and changing .c to .wasm
ALL_WASM := $(patsubst $(SRC_ROOT)/%.c,$(WASM_OUT)/%.wasm,$(ALL_SOURCES))

all: $(ALL_WASM)

# Pattern rule to compile .c to .wasm
$(WASM_OUT)/%.wasm: $(SRC_ROOT)/%.c
	@mkdir -p $(dir $@)
	$(WASMC) $(WASMC_OPTS) $< $(WASMC_INCLUDE) -o $@

.PHONY: all

